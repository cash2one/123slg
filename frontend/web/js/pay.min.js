function hideLayer(a) {
    a.css("display", "none")
}
function showLayer(a) {
    a.css("display", "block")
}
function tabs(a) {
    $.each(a.siblings("li"), function (b, c) {
        hideLayer($("." + $(c).attr("id")))
    })
}
function pop(a) {
    showLayer($("." + a.attr("id")));
    tabs(a)
}
function checkedVal(a) {
    a.prop("checked", true)
}
function unCheckedVal(a) {
    a.prop("checked", false)
}
function addCls(a) {
    a.parent("li").addClass("current");
    $("#tipPayWay span").text(a.text());
    showLayer($("#" + $(this).attr("class")))
}
function removeCls(a) {
    $.each(a.parent("li").siblings("li"), function (b, c) {
        $(c).removeClass("current")
    });
    hideLayer($("#" + a.attr("class")).siblings("div"));
    showLayer($("#" + a.attr("class")))
}
function splitStr(b, a) {
    if (typeof b != undefined && b.val() != undefined) {
        return b.val().split("#")[a]
    }
}
$(document).ready(function () {
    var c = {
        playerId: "请先确定充值帐号！",
        noPlayerId: "该帐户名不存在！",
        gameId: "请选择游戏！",
        serverId: "请选择游戏服务器！",
        roleId: "请选择角色！",
        money: "请选择充值金额！",
        bankCode: "请选择银行！"
    };
    if (!$.support.leadingWhitespace) {
        var d = $(window).width();
        var a = $(window).height();
        var e = document.body.clientHeight;
        if (e > a) {
            a = e
        }
        $(".maskLayer").css({width: d, height: a})
    }
    checkedVal($("input[name=gold]:visible:first"));
    $(".payWay li span").click(function (g) {
        removeCls($(this));
        addCls($(this));
        var f = $(this).attr("id").split("#");
        if (typeof f[f.length - 1] != undefined && f.length == 2) {
            $("#payCom").val(f[0]);
            $("#payType").val(f[1])
        } else {
            $("#payCom").val("");
            $("#payType").val(f[0])
        }
        unCheckedVal($("input[name=gold]"));
        checkedVal($("input[name=gold]:visible:first"))
    });
    if ($("#userName").val() == "" || $("#userName").val() == null || $("#userName").val() == undefined) {
        $.getJSON("http://www.123slg.com/jsonp.action?jsoncallback=?", {
            funName: "checkLogin",
            x: Math.random()
        }, function (f) {
            if (f.success) {
                $("#userName").val(f.current_user.username)
            }
        }, "json")
    }
    $(".gameSerRole").delegate("li#game", "click", function (f) {
        var g = $(this);
        if ($("#userName").val() != "") {
            $.ajax({
                url: "payinfo/checkplayer.xhtml",
                type: "post",
                dataType: "json",
                data: {playerId: $("#userName").val()},
                success: function (h) {
                    if (h.exist == true) {
                        $("#checkName").html('<em style="color:green;">此帐号可用！</em>');
                        pop(g)
                    } else {
                        $("#checkName").text(c.noPlayerId)
                    }
                }
            })
        } else {
            $("#checkName").text(c.playerId)
        }
    });
    $(".gameSerRole").delegate("li#server", "click", function (f) {
        if ($("#userName").val() != "") {
            pop($(this))
        } else {
            $("#checkName").text(c.playerId)
        }
    });
    if (splitStr($("input[name=game]:checked"), 0) != "as") {
        $(".gameSerRole").delegate("li#role", "click", function (f) {
            if ($("#userName").val() != "") {
                pop($(this))
            } else {
                $("#checkName").text(c.playerId)
            }
        })
    } else {
        hideLayer($("#role"))
    }
    $(".game").delegate("div.close", "click", function (f) {
        hideLayer($(this).parent())
    });
    $(".game").delegate("input[name=game]", "click", function (f) {
        hideLayer($(".game"));
        $("#game").text($(this).parent().text());
        if (splitStr($("input[name=game]:checked"), 0) == "as") {
            hideLayer($("#role"));
            $("#server").text(c.serverId)
        } else {
            showLayer($("#role"));
            $("#server").text(c.serverId);
            $("#role").text(c.roleId)
        }
        showLayer($(".server"));
        $.ajax({
            type: "post",
            url: "payinfo/servers.xhtml",
            dataType: "json",
            data: {gameId: splitStr($("input[name=game]:checked"), 0)},
            success: function (h) {
                var g = "";
                $.each(h, function (j, k) {
                    for (i in k) {
                        g += '<li><label for="s' + k[i].id + '"><input id="s' + k[i].id + '" type="radio" name="server" value="' + k[i].id + "#" + k[i].name + '"><span>' + k[i].name + "</span></label></li>"
                    }
                });
                $(".allSer").html(g)
            }
        })
    });
    $(".server").delegate("div.close", "click", function (f) {
        hideLayer($(this).parent())
    });
    $(".server").delegate("input[name=server]", "click", function (f) {
        if (splitStr($("input[name=game]:checked"), 0) != "as") {
            if ($("#userName").val() != "") {
                $.ajax({
                    type: "post",
                    url: "payinfo/roles.xhtml",
                    dataType: "json",
                    data: {
                        playerId: $("#userName").val(),
                        gameId: splitStr($("input[name=game]:checked"), 0),
                        serverId: splitStr($("input[name=server]:checked"), 0)
                    },
                    success: function (h) {
                        var g = "";
                        $.each(h, function (j, k) {
                            for (i in k) {
                                g += '<li><label for="r' + k[i].id + '"><input id="r' + k[i].id + '" type="radio" name="role" value="' + k[i].id + "#" + k[i].name + '"><span>' + k[i].name + "</span></label></li>"
                            }
                        });
                        $(".hisRole").html(g)
                    }
                });
                $("#role").text(c.roleId);
                showLayer($(".role"))
            } else {
                $("#checkName").text(c.playerId)
            }
        }
        hideLayer($(".server"));
        $("#server").text($(this).parent().text())
    });
    $(".role").delegate("div.close", "click", function (f) {
        hideLayer($(this).parent())
    });
    $(".role").delegate("input[name=role]", "click", function (f) {
        hideLayer($(".role"));
        $("#role").text($(this).parent().text())
    });
    $(".bank input").click(function (f) {
        checkedVal($(this))
    });
    var b;
    $.each($(".payBtn"), function (f, g) {
        $(g).delegate("input.submit", "click", function (l) {
            var s = $("#payType").val(), q = $("#payCom").val(), m = $("#userName").val(), r = splitStr($("input[name=game]:checked"), 0), p = splitStr($("input[name=server]:checked"), 0), k = splitStr($("input[name=server]:checked"), 1), n = splitStr($("input[name=role]:checked"), 0), o = splitStr($("input[name=role]:checked"), 1), j = splitStr($(".money").find($("input[name=gold]:visible:checked")), 0), h = splitStr($("input[name=bank]:checked"), 0);
            if (s == "ONLINEBANK" || s == "ALIPAY" || s == "TELPHONE" || s == "WEIXIN") {
            } else {
                q = $("input[name=payCom]:checked").val()
            }
            if (!checkName(m)) {
                return false
            }
            if (r == "as") {
                n = "";
                o = ""
            }
            if (m != "" && r != undefined && p != undefined && n != undefined && j != undefined && q != "") {
                if (q == "ALIPAY" && s == "ONLINEBANK") {
                    if (h == undefined) {
                        alert(c.bankCode);
                        return false
                    }
                } else {
                    h = ""
                }
                $.ajax({
                    url: "paygateway/topay.xhtml",
                    type: "post",
                    dataType: "json",
                    data: {
                        payCom: q,
                        payType: s,
                        playerId: m,
                        gameId: r,
                        serverId: p,
                        serverName: k,
                        roleId: n,
                        roleName: o,
                        money: j,
                        bankCode: h
                    },
                    success: function (u) {
                        b = u.order.payCom;
                        if (u.state == "1") {
                            showLayer($(".maskLayer"));
                            var t = "";
                            t += '<li><span class="w1">您的充值方式：</span><span>' + u.order.payType + '</span></li><li><span class="w1">您的订单号：</span><span>' + u.order.orderId + '</span></li><li><span class="w1">您的充值帐号：</span><span>' + u.order.playerId + '</span></li><li><span class="w1">您所指定的游戏：</span><span>' + u.order.gameName + "</span></li>";
                            if (u.order.gameId != "as") {
                                t += '<li><span class="w1">您所指定的角色名：</span><span>' + u.order.roleName + "</span></li>"
                            }
                            t += '<li><span class="w1">您的充值金额：</span><span>' + u.order.money + '</span></li><li><span class="w1">您获得的金币数量：</span><span>' + u.order.gold + "</span></li>";
                            $(".payInfo ul").html(t);
                            showLayer($(".payInfo"));
                            $("#orderId").val(u.order.orderId);
                            $("#ticket").val(u.ticket)
                        } else {
                        }
                    }
                })
            } else {
                if (m == "") {
                    alert(c.playerId)
                } else {
                    if (r == undefined) {
                        alert(c.gameId)
                    } else {
                        if (p == undefined) {
                            alert(c.serverId)
                        } else {
                            if (n == undefined) {
                                alert(c.roleId)
                            } else {
                                if (j == undefined) {
                                    alert(c.money)
                                }
                            }
                        }
                    }
                }
            }
        })
    });
    $(".payInfo").delegate("div.close", "click", function (f) {
        hideLayer($(this).parent());
        hideLayer($(".maskLayer"))
    });
    $(".payInfo").delegate("input#back", "click", function (f) {
        hideLayer($(".maskLayer"));
        hideLayer($(this).parent().parent().parent())
    });
    $(".payInfo").delegate("input#togateway", "click", function (f) {
        hideLayer($(this).parent().parent().parent());
        $("#result").attr("href", "paygateway/showorder.xhtml?orderId=" + $("#orderId").val() + "&ticket=" + $("#ticket").val());
        $("#help").attr("href", "paygateway/help.xhtml#" + $("#payType").val());
        showLayer($(".maskLayer"));
        showLayer($(".payResult"));
        if (b == "GANIU") {
            $.ajax({
                url: "weixinQR.xhtml",
                type: "post",
                dataType: "json",
                data: {order3rd: $("#orderId").val(), fee: $("#ticket").val()},
                success: function (g) {
                    try {
                        var j = "";
                        j += '<img id="qrcode" src="' + g.qrcUrl + '" width="140" height="140"><br><p>充值金额：' + g.money + "</p><p>订单编号：" + g.orderId + "</p>";
                        $(".wxInfo").html(j);
                        showLayer($(".weixinqrc"))
                    } catch (h) {
                    }
                }
            })
        } else {
            $("#togatewayForm").submit()
        }
    });
    $(".payResult,.weixinqrc").delegate("div.close", "click", function (f) {
        hideLayer($(this).parent());
        hideLayer($(".maskLayer"))
    });
    $(".payResult").delegate("input#back", "click", function (f) {
        hideLayer($(".maskLayer"));
        hideLayer($(this).parent().parent())
    })
});
function checkName(a) {
    if (a != "") {
        $.ajax({
            url: "payinfo/checkplayer.xhtml",
            type: "post",
            async: false,
            dataType: "json",
            data: {playerId: $("#userName").val()},
            success: function (b) {
                if (b.exist == true) {
                    window.isAlready = true
                } else {
                    window.isAlready = false
                }
            }
        })
    } else {
        window.isAlready = false
    }
    if (!window.isAlready) {
        alert("\u8D26\u53F7" + a + "\u4E0D\u5B58\u5728\uFF01");
        return false
    }
    return true
};